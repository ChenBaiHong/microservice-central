# Elasticsearch 7.8 参考

## 什么是 Elasticsearch？

***You know, for search (and analysis)***

Elasticsearch是Elastic Stack核心的分布式搜索和分析引擎。 Logstash 和 Beats 有助于收集，聚合和丰富您的数据并将其存储在 Elasticsearch 中。使用Kibana，您可以交互式地探索，可视化和共享对数据的见解，并管理和监视堆栈。 Elasticsearch 是索引、搜索和分析 发生神奇地方。

Elasticsearch为所有类型的数据提供近乎实时的搜索和分析。无论您是结构化文本还是非结构化文本，数字数据或地理空间数据，Elasticsearch都可以通过支持快速搜索的方式有效地对其进行存储和索引。您不仅可以进行简单的数据检索，还可以汇总信息来发现数据中的趋势和模式。随着数据和查询量的增长，Elasticsearch的分布式特性使您的部署可以随之无缝地增长。

尽管并非每个问题都是搜索问题，但是Elasticsearch都提供了速度和灵活性来处理各种用例中的数据：

* 将搜索框添加到应用或网站
* 存储和分析日志，指标和安全事件数据
* 使用机器学习实时自动建模数据行为
* 使用Elasticsearch作为存储引擎自动化业务工作流程
* 使用Elasticsearch作为地理信息系统（GIS）管理，集成和分析空间信息
* 使用Elasticsearch作为生物信息学研究工具来存储和处理遗传数据

人们不断使用搜索的新颖方式使我们不断感到惊讶。但是，无论您的用例是其中之一还是使用Elasticsearch解决新问题，在Elasticsearch中处理数据，文档和索引的方式都是相同的。

Elasticsearch是一个基于Apache Lucene(TM)的开源搜索引擎，无论在开源还是专有领域，Lucene可以被认为是迄今为止最先进、性能最好的、功能最全的搜索引擎库。 
但是，Lucene只是一个库。想要发挥其强大的作用，你需使用Java并要将其集成到你的应用中。Lucene非常复杂，你需要深入的了解检索相关知识来理解它是如何工作的。 
Elasticsearch也是使用Java编写并使用Lucene来建立索引并实现搜索功能，但是它的目的是通过简单连贯的RESTful API让全文搜索变得简单并隐藏Lucene的复杂性。 
不过，Elasticsearch不仅仅是Lucene和全文搜索引擎，它还提供：

- 分布式的实时文件存储，每个字段都被索引并可被搜索
- 实时分析的分布式搜索引擎
- 可以扩展到上百台服务器，处理PB级结构化或非结构化数据

而且，所有的这些功能被集成到一台服务器，你的应用可以通过简单的RESTful API、各种语言的客户端甚至命令行与之交互。上手Elasticsearch非常简单，它提供了许多合理的缺省值，并对初学者隐藏了复杂的搜索引擎理论。它开箱即用（安装即可使用），只需很少的学习既可在生产环境中使用。Elasticsearch在Apache 2 license下许可使用，可以免费下载、使用和修改。 
随着知识的积累，你可以根据不同的问题领域定制Elasticsearch的高级特性，这一切都是可配置的，并且配置非常灵活。

## Elasticsearch 核心概念

1. **接近实时（NRT）** 

   Elasticsearch是一个接近实时的搜索平台。这意味着，从索引一个文档直到这个文档能够被搜索到有一个轻微的延迟（通常是1秒）。

2. **集群（cluster）**

   一个集群就是由一个或多个节点组织在一起，它们共同持有你整个的数据，并一起提供索引和搜索功能。一个集群由一个唯一的名字标识，这个名字默认就是“elasticsearch”。这个名字是重要的，因为一个节点只能通过指定某个集群的名字，来加入这个集群。在产品环境中显式地设定这个名字是一个好习惯，但是使用默认值来进行测试/开发也是不错的。

3. **节点（node）**

   一个节点是你集群中的一个服务器，作为集群的一部分，它存储你的数据，参与集群的索引和搜索功能。和集群类似，一个节点也是由一个名字来标识的，默认情况下，这个名字是一个随机的漫威漫画角色的名字，这个名字会在启动的时候赋予节点。这个名字对于管理工作来说挺重要的，因为在这个管理过程中，你会去确定网络中的哪些服务器对应于Elasticsearch集群中的哪些节点。

   一个节点可以通过配置集群名称的方式来加入一个指定的集群。默认情况下，每个节点都会被安排加入到一个叫做“elasticsearch”的集群中，这意味着，如果你在你的网络中启动了若干个节点，并假定它们能够相互发现彼此，它们将会自动地形成并加入到一个叫做“elasticsearch”的集群中。

   在一个集群里，只要你想，可以拥有任意多个节点。而且，如果当前你的网络中没有运行任何Elasticsearch节点，这时启动一个节点，会默认创建并加入一个叫做“elasticsearch”的集群。

4.  **索引（index） **

   一个索引就是一个拥有几分相似特征的文档的集合。比如说，你可以有一个客户数据的索引，另一个产品目录的索引，还有一个订单数据的索引。一个索引由一个名字来标识（必须全部是小写字母的），并且当我们要对对应于这个索引中的文档进行索引、搜索、更新和删除的时候，都要使用到这个名字。索引类似于关系型数据库中Database的概念。在一个集群中，如果你想，可以定义任意多的索引。

5.  **类型（type） **

   在一个索引中，你可以定义一种或多种类型。一个类型是你的索引的一个逻辑上的分类/分区，其语义完全由你来定。通常，会为具有一组共同字段的文档定义一个类型。比如说，我们假设你运营一个博客平台并且将你所有的数据存储到一个索引中。在这个索引中，你可以为用户数据定义一个类型，为博客数据定义另一个类型，当然，也可以为评论数据定义另一个类型。类型类似于关系型数据库中Table的概念。

6. **文档（document） **

   一个文档是一个可被索引的基础信息单元。比如，你可以拥有某一个客户的文档，某一个产品的一个文档，当然，也可以拥有某个订单的一个文档。文档以JSON（Javascript Object Notation）格式来表示，而JSON是一个到处存在的互联网数据交互格式。 
   在一个index/type里面，只要你想，你可以存储任意多的文档。注意，尽管一个文档，物理上存在于一个索引之中，文档必须被索引/赋予一个索引的type。文档类似于关系型数据库中 Record 的概念。实际上一个文档除了用户定义的数据外，还包括`_index`、`_type`和`_id`字段。

7.  **分片和复制（shards & replicas）** 

   一个索引可以存储超出单个结点硬件限制的大量数据。比如，一个具有10亿文档的索引占据1TB的磁盘空间，而任一节点都没有这样大的磁盘空间；或者单个节点处理搜索请求，响应太慢。

   为了解决这个问题，Elasticsearch提供了将索引划分成多份的能力，这些份就叫做分片。当你创建一个索引的时候，你可以指定你想要的分片的数量。每个分片本身也是一个功能完善并且独立的“索引”，这个“索引”可以被放置到集群中的任何节点上。 
   分片之所以重要，主要有两方面的原因：

   - 允许你水平分割/扩展你的内容容量
   - 允许你在分片（潜在地，位于多个节点上）之上进行分布式的、并行的操作，进而提高性能/吞吐量

   至于一个分片怎样分布，它的文档怎样聚合回搜索请求，是完全由Elasticsearch管理的，对于作为用户的你来说，这些都是透明的。

   在一个网络/云的环境里，失败随时都可能发生，在某个分片/节点不知怎么的就处于离线状态，或者由于任何原因消失了。这种情况下，有一个故障转移机制是非常有用并且是强烈推荐的。为此目的，Elasticsearch允许你创建分片的一份或多份拷贝，这些拷贝叫做复制分片，或者直接叫复制。复制之所以重要，主要有两方面的原因：

   - 在分片/节点失败的情况下，提供了高可用性。因为这个原因，注意到复制分片从不与原/主要（original/primary）分片置于同一节点上是非常重要的。
   - 扩展你的搜索量/吞吐量，因为搜索可以在所有的复制上并行运行

   总之，每个索引可以被分成多个分片。一个索引也可以被复制0次（意思是没有复制）或多次。一旦复制了，每个索引就有了主分片（作为复制源的原来的分片）和复制分片（主分片的拷贝）之别。分片和复制的数量可以在索引创建的时候指定。在索引创建之后，你可以在任何时候动态地改变复制数量，但是不能改变分片的数量。

   默认情况下，Elasticsearch中的每个索引被分片5个主分片和1个复制，这意味着，如果你的集群中至少有两个节点，你的索引将会有5个主分片和另外5个复制分片（1个完全拷贝），这样的话每个索引总共就有10个分片。一个索引的多个分片可以存放在集群中的一台主机上，也可以存放在多台主机上，这取决于你的集群机器数量。主分片和复制分片的具体位置是由ES内在的策略所决定的。

8. elasticsearch 是面向文档**非关系型数据库** 和 **关系数据库** 客观对比

   <table>
   <table border=0 cellpadding=0 cellspacing=0 width=714>
    <col width=175>
    <col width=177>
    <col width=185>
   <tr height=23 style='height:17.0pt'>
     <td class=xl64 width=175 style='width:131pt;font-size:18px'>Relational DB</td>
     <td class=xl64 width=177 style='width:133pt;font-size:18px'>Elasticsearch</td>
    </tr>
    <tr height=57 style='height:43.0pt'>
     <td class=xl67 width=87 style='width:65pt'>数据库(database)</td>
     <td class=xl68 width=87 style='width:65pt'>索引(indices)</td>
    </tr>
    <tr height=57 style='height:43.0pt'>
     <td class=xl67 width=87 style='width:65pt'>表(tables)</td>
     <td class=xl68 width=87 style='width:65pt'>types</td>
    </tr>
    <tr height=57 style='height:43.0pt'>
     <td class=xl67 width=87 style='width:65pt'>行(rows)</td>
     <td class=xl68 width=87 style='width:65pt'>documents</td>
    </tr>
    <tr height=57 style='height:43.0pt'>
     <td class=xl67 width=87 style='width:65pt'>字段(columns)</td>
     <td class=xl68 width=87 style='width:65pt'>fields</td>
    </tr>
   </table>

   

